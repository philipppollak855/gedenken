{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static 'admin/css/custom_dashboard.css' %}">
{% endblock %}

{% block content %}
<div id="content-main" style="
    --stat-users-color: {{ settings.stat_users_color|default:'#d1ecf1' }};
    --stat-pages-color: {{ settings.stat_pages_color|default:'#d1ecf1' }};
    --stat-releases-color: {{ settings.stat_releases_color|default:'#fff3cd' }};
    --stat-condolences-color: {{ settings.stat_condolences_color|default:'#f8d7da' }};
">
    <h1>{{ title }}</h1>
    <div class="dashboard-grid">
        
        <div class="dashboard-widget stat-widget">
            <h2>Auf einen Blick</h2>
            <div class="stat-grid">
                <div class="stat-item users">
                    <div class="value">{{ stats.total_users }}</div>
                    <div class="label">Benutzer</div>
                </div>
                <div class="stat-item pages">
                    <div class="value">{{ stats.total_pages }}</div>
                    <div class="label">Gedenkseiten</div>
                </div>
                <div class="stat-item releases">
                    <div class="value">{{ stats.pending_releases }}</div>
                    <div class="label">Offene Freigaben</div>
                </div>
                <div class="stat-item condolences">
                    <div class="value">{{ stats.unapproved_condolences }}</div>
                    <div class="label">Ungelesene Kondolenzen</div>
                </div>
            </div>
        </div>

        <div class="dashboard-widget quick-links-widget">
            <h2>Schnellzugriff</h2>
            <div class="quick-links">
                <a href="{% url 'admin:api_memorialpage_add' %}"><i class="fas fa-book-dead"></i> Neue Gedenkseite</a>
                <a href="{% url 'admin:api_user_add' %}"><i class="fas fa-user-plus"></i> Neuen Benutzer anlegen</a>
                <a href="{% url 'admin:api_releaserequest_changelist' %}"><i class="fas fa-key"></i> Freigabe-Anfragen prüfen</a>
                <a href="{% url 'admin:api_mediaasset_changelist' %}"><i class="fas fa-photo-video"></i> Mediathek verwalten</a>
            </div>
        </div>

        <div class="dashboard-widget activity-widget full-width">
            <h2>Kommende Termine (Nächste 30 Tage)</h2>
            <div class="activity-list">
                <table>
                    <tbody>
                        {% for event in upcoming_events %}
                        <tr>
                            <td><span class="event-date">{{ event.date|date:"d. M" }}</span></td>
                            <td><strong>{{ event.title }}</strong> für <a href="{% url 'admin:api_memorialpage_change' event.page.pk %}">{{ event.page }}</a></td>
                            <td><span class="meta">{{ event.date|date:"H:i" }} Uhr</span></td>
                            <td><span class="meta">{{ event.attendee_count }} Zusagen</span></td>
                            <td><a href="{% url 'admin:api_memorialevent_change' event.pk %}" class="button">Details</a></td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="5">Keine kommenden Termine gefunden.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="dashboard-widget activity-widget">
            <h2>Letzte Kondolenzen</h2>
            <div class="activity-list">
                <ul>
                    {% for condolence in latest_condolences %}
                    <li>
                        <strong>{{ condolence.guest_name }}</strong> für <a href="{% url 'admin:api_memorialpage_change' condolence.page.pk %}">{{ condolence.page }}</a>
                        <div class="meta">{{ condolence.created_at|timesince }} ago</div>
                    </li>
                    {% empty %}
                    <li>Keine Kondolenzen vorhanden.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <div class="dashboard-widget activity-widget">
            <h2>Letzte Gedenkkerzen</h2>
            <div class="activity-list">
                <ul>
                    {% for candle in latest_candles %}
                    <li>
                        <strong>{{ candle.guest_name }}</strong> für <a href="{% url 'admin:api_memorialpage_change' candle.page.pk %}">{{ candle.page }}</a>
                        <div class="meta">{{ candle.created_at|timesince }} ago</div>
                    </li>
                    {% empty %}
                    <li>Keine Kerzen angezündet.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>

    </div>
</div>
{% endblock %}